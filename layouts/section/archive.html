{{ define "main" }}
<div class="gallery-header"><h1 class="gallery-title">archive</h1></div>

<div class="asymmetric-feed">
    {{/* Collect all images from the gallery section */}}
    {{ $allImages := slice }}
    {{ range (.Site.GetPage "section" "gallery").Sections }}
        {{ range .Resources.ByType "image" }}{{ $allImages = $allImages | append . }}{{ end }}
    {{ end }}
    
    {{ range sort $allImages "Name" "desc" }}
        <div class="feed-item">
            <div class="feed-image-frame" onclick="openLightbox('{{ .RelPermalink }}')">
                {{ $w900 := .Resize "900x" }}
                <img src="{{ $w900.RelPermalink }}" 
                     alt="photography" loading="lazy" 
                     class="feed-img">
            </div>
            
            <div class="feed-text-content">
                {{ $dateStr := replaceRE "^(\\d{4})(\\d{2})(\\d{2}).*" "$1-$2-$3" .Name }}
                <span class="feed-date">{{ $dateStr }}</span>
                
                {{/* Tech Spec Parsing Logic */}}
                {{ $base := index (split .Name "--") 0 }}
                {{ if gt (len $base) 16 }}
                    {{ $techRaw := substr $base 16 }}
                    {{ $parts := split $techRaw "_" }}
                    {{ if ge (len $parts) 4 }}
                        {{ $shutter := index $parts (sub (len $parts) 1) | replaceRE "1-" "1/" }}
                        {{ $aperture := index $parts (sub (len $parts) 2) }}
                        {{ $iso := index $parts (sub (len $parts) 3) }}
                        {{ $camParts := first (sub (len $parts) 3) $parts }}
                        {{ $camera := delimit $camParts " " }}
                        
                        <p class="feed-meta">
                            {{ (print $camera) | lower }}<br>
                            {{ (print "iso " $iso " • f/" $aperture " • " $shutter " s") | lower }}
                        </p>
                    {{ end }}
                {{ end }}
                
                <span class="feed-action" onclick="openLightbox('{{ .RelPermalink }}')">view details</span>
            </div>
        </div>
    {{ end }}
</div>
{{ end }}
