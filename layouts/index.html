{{ define "main" }}
<div class="carousel-container" id="carousel">
    {{ $allImages := slice }}
    {{/* 1. Use the Section lookup that works */}}
    {{ range (.Site.GetPage "section" "gallery").Sections }}
        {{ range .Resources.ByType "image" }}
            {{ $allImages = $allImages | append . }}
        {{ end }}
    {{ end }}

    {{ range first 10 (shuffle $allImages) }}
    {{ $thumb := .Resize "1200x" }}
    <div class="carousel-slide" data-index="{{ .Name }}">
        {{/* This is the blurred background */}}
        <div class="carousel-bg" style="background-image: url('{{ .RelPermalink }}')"></div>
        
        {{/* FIX: Added class="carousel-img" below */}}
        <img src="{{ $thumb.RelPermalink }}" 
             class="carousel-img" 
             alt="{{ .Name }}" 
             loading="lazy"
             onclick="openLightbox('{{ .RelPermalink }}')"
             style="opacity: 0; transition: opacity 0.5s ease-in;"
             onload="this.style.opacity=1;">
    </div>
    {{ end }}

    <div class="carousel-nav prev" onclick="moveSlide(-1)">&#10094;</div>
    <div class="carousel-nav next" onclick="moveSlide(1)">&#10095;</div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const slides = document.querySelectorAll('.carousel-slide');
        if(slides.length > 0) slides[0].classList.add('active');
    });
</script>
{{ end }}
