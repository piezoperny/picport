{{ define "main" }}
<div class="carousel-container" id="carousel">
    {{/* 1. Get the gallery section */}}
    {{ $gallery := .Site.GetPage "section" "gallery" }}
    
    {{/* 2. Collect images from all subsections */}}
    {{ $allImages := slice }}
    {{ range $gallery.Sections }}
        {{ range .Resources.ByType "image" }}
            {{ $allImages = $allImages | append . }}
        {{ end }}
    {{ end }}

    {{/* 3. Shuffle and display */}}
    {{ range first 10 (shuffle $allImages) }}
    <div class="carousel-slide" data-index="{{ .Name }}">
        <div class="carousel-bg" style="background-image: url('{{ .RelPermalink }}')"></div>
        <img src="{{ $thumb.RelPermalink }}" 
         alt="{{ .Name }}" 
         loading="lazy"
         onclick="openLightbox('{{ .RelPermalink }}')"
         style="opacity: 0; transition: opacity 0.5s ease-in;"
         onload="this.style.opacity=1;">
    </div>
    {{ end }}

    <div class="carousel-nav prev" onclick="moveSlide(-1)">&#10094;</div>
    <div class="carousel-nav next" onclick="moveSlide(1)">&#10095;</div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const slides = document.querySelectorAll('.carousel-slide');
        if(slides.length > 0) slides[0].classList.add('active');
    });
</script>
{{ end }}

