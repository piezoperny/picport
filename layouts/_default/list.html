{{ define "main" }}
<div class="gallery-header">
    <h1 class="gallery-title">{{ .Title | lower }}</h1>
</div>
<div class="masonry-grid">
    {{ range sort (.Resources.ByType "image") "Name" "desc" }}
        
        <div class="grid-item">
            <div class="image-holder" style="position: relative; width: 100%; background-image: url('{{ (.Resize "20x jpg q20").RelPermalink }}'); background-size: cover; overflow: hidden;">
                {{ $thumb := .Resize "600x" }} 
                <img src="{{ $thumb.RelPermalink }}" 
                     alt="{{ .Name }}" 
                     loading="lazy"
                     onclick="openLightbox('{{ .RelPermalink }}')"
                     style="width: 100%; display: block; opacity: 0; transition: opacity 0.5s ease-in;"
                     onload="this.style.opacity=1;">
            </div>

            <div class="meta-holder" style="padding: 8px 4px 0 4px;">
                
                {{ $dateStr := replaceRE "^(\\d{4})(\\d{2})(\\d{2}).*" "$1-$2-$3" .Name }}
                {{ if ne $dateStr .Name }}
                    <div class="photo-date">{{ $dateStr }}</div>
                {{ end }}

                {{ $parts := split .Name "-" }}
                {{ if gt (len $parts) 1 }}
                    {{ $infoRaw := index $parts 1 }}
                    {{ $infoClean := replaceRE "(?i)\\.(jpg|jpeg|png|webp|gif)$" "" $infoRaw }}
                    {{ $stats := split $infoClean "_" }}
                    
                    {{ if ge (len $stats) 4 }}
                        <div class="photo-exif" style="font-size: 0.65rem; color: #666; text-align: right; margin-top: 2px;">
                            {{ index $stats 0 | lower }} • 
                            iso {{ index $stats 1 }} • 
                            f/{{ index $stats 2 }} • 
                            {{ replace (index $stats 3) "-" "/" }}s
                        </div>
                    {{ end }}
                {{ end }}
            </div>
        </div>
    {{ end }}
</div>
{{ end }}
