{{ define "main" }}
<div class="gallery-header"><h1 class="gallery-title">{{ .Title | lower }}</h1></div>
<div class="masonry-grid">
    {{ range sort (.Resources.ByType "image") "Name" "desc" }}
        <div class="grid-item">
            <div class="image-holder" style="background-image: url('{{ (.Resize "20x jpg q20").RelPermalink }}');">
                {{ $w600 := .Resize "600x" }}
                <img src="{{ $w600.RelPermalink }}" 
                     srcset="{{ (.Resize "300x").RelPermalink }} 300w, {{ $w600.RelPermalink }} 600w, {{ (.Resize "900x").RelPermalink }} 900w"
                     sizes="(max-width: 600px) 48vw, (max-width: 1200px) 30vw, 350px"
                     alt="photography" loading="lazy"
                     data-timestamp="{{ substr .Name 0 15 }}"
                     onclick="openLightbox('{{ .RelPermalink }}')"
                     onload="this.classList.add('loaded'); resizeGridItem(this.closest('.grid-item'));">
            </div>
            <div class="meta-holder">
                {{/* Tech Spec Parsing Logic */}}
                {{ $base := index (split .Name "--") 0 }} {{/* Remove Coords */}}
                {{ if gt (len $base) 16 }}
                    {{ $techRaw := substr $base 16 }} {{/* Remove Date Prefix */}}
                    {{ $parts := split $techRaw "_" }}
                    {{ if ge (len $parts) 4 }}
                        {{ $shutter := index $parts (sub (len $parts) 1) | replaceRE "1-" "1/" }}
                        {{ $aperture := index $parts (sub (len $parts) 2) }}
                        {{ $iso := index $parts (sub (len $parts) 3) }}
                        {{ $camParts := first (sub (len $parts) 3) $parts }}
                        {{ $camera := delimit $camParts " " }}
                        
                        <div class="photo-meta">
                             {{ (print $camera " • iso " $iso " • f/" $aperture " • " $shutter " s") | lower }}
                        </div>
                    {{ end }}
                {{ end }}

                {{ if ne $dateStr .Name }}<div class="photo-date">{{ replaceRE "^(\\d{4})(\\d{2})(\\d{2}).*" "$1-$2-$3" .Name }}</div>{{ end }}
            </div>
        </div>
    {{ end }}
</div>
{{ end }}
