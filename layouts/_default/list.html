{{ define "main" }}
<div class="layout-controls">
    <button id="btn-list" class="layout-btn active">list</button>
    <span>/</span>
    <button id="btn-grid" class="layout-btn">grid</button>
</div>

<div class="gallery-header"><h1 class="gallery-title">{{ .Title | lower }}</h1></div>

<div id="gallery-feed" class="layout-list">
    {{ range sort (.Resources.ByType "image") "Name" "desc" }}
        <div class="gallery-item">
            <div class="media-frame" onclick="openLightbox('{{ .RelPermalink }}')">
                {{ $w900 := .Resize "900x" }}
                <img src="{{ $w900.RelPermalink }}" 
                     alt="photography" loading="lazy" 
                     onload="resizeGridItem(this.closest('.gallery-item'))">
            </div>
            
            <div class="gallery-meta">
                {{ $dateStr := replaceRE "^(\\d{4})(\\d{2})(\\d{2}).*" "$1-$2-$3" .Name }}
                {{ if ne $dateStr .Name }}
                    <span class="meta-date">{{ $dateStr }}</span>
                {{ end }}
                
                {{/* Tech Spec Parsing Logic */}}
                {{ $base := index (split .Name "--") 0 }}
                {{ if gt (len $base) 16 }}
                    {{ $techRaw := substr $base 16 }}
                    {{ $parts := split $techRaw "_" }}
                    {{ if ge (len $parts) 4 }}
                        {{ $shutter := index $parts (sub (len $parts) 1) | replaceRE "1-" "1/" }}
                        {{ $aperture := index $parts (sub (len $parts) 2) }}
                        {{ $iso := index $parts (sub (len $parts) 3) }}
                        {{ $camParts := first (sub (len $parts) 3) $parts }}
                        {{ $camera := delimit $camParts " " }}
                        
                        <div class="meta-tech">
                            {{ (print $camera) | lower }}<br>
                            {{ (print "iso " $iso " • f/" $aperture " • " $shutter " s") | lower }}
                        </div>
                    {{ end }}
                {{ end }}
                
                <span class="meta-action" onclick="openLightbox('{{ .RelPermalink }}')">view details</span>
            </div>
        </div>
    {{ end }}
</div>
{{ end }}
